cluster:
  name: pro
  domain: pro.redhat.com
  fqdn: pro.redhat.com
  address: &api "https://api.cluster1.sandbox1990.opentlc.com:6443"
  environment: &environment pro
  datacenter: europe
  region: &region eu 
  registry: quay-pro.io

ops_namespace: &ops "cluster-ops"

sync_policy_true: &sync_policy_true
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
    - Validate=true

teams: &teams
  - name: team1
  - name: team2

gitops-operator:
  operator: false
  secrets: false
  namespaces: false
  ignoreHelmHooks: true
namespaces: false

applications:
  - name: gitops-operator
    enabled: true
    source: https://github.com/misanche/gitops-for-organizations.git
    cluster_api: *api
    source_path: base/components/bootstrap
    source_ref: main
    sync_policy: *sync_policy_true
    disable_app_finalizer: true
    destination: cluster-ops
    values:
      namespaces:
      - name: *ops
        labels:
          argocd.argoproj.io/managed-by: *ops
        annotations:
          "helm.sh/resource-policy": keep # Never delete the cluster-ops namespace
      gitops-operator:
        enabled: true
        # Since this is designed to be run before the cluster knows anything about the argocd CR, we need to use helm hooks to control the ordering
        # This means that the cluster argocd resource is deployed as a helm hook rather than a managed resource
        # This has the side-effect that every time you run "helm upgrade" argocd will be deleted and recreated
        # It should not affect the applications
        ignoreHelmHooks: false
        name: argocd
        teamInstancesAreClusterScoped: true
        operator: false
          # channel: latest
          # disableDefaultArgoCD: true
        namespaces:
        - *ops
        argocd_cr:
          version: v2.8.3
    
  - name: team-argocd
    enabled: true
    source: https://github.com/misanche/gitops-for-organizations.git
    cluster_api: *api
    source_path: base/components/team-argo
    source_ref: main
    sync_policy: *sync_policy_true
    disable_app_finalizer: true
    destination: cluster-ops
    values:
      teams: *teams
      team_namespaces:
        - name: ci-cd
        - name: pro
      repo_url: https://github.com/misanche/gitops-for-organizations.git
      repo_target_revision: main
      gitops_operator_chart_version: 0.8.4
      argocd_version: v2.8.3
      region: *region
      cluster: *environment